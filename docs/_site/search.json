[
  {
    "objectID": "isochrones.html",
    "href": "isochrones.html",
    "title": "Isochrones calculator",
    "section": "",
    "text": "In geospatial analysis, one of the most important issues is identifying objects of interest that are within range of a given point. Think of all the cell phones that can be reached by an antenna, all the medical centers around a point in the city, and all the competitors near a store. For most of these problems, the most immediate solution is to define the range from a point in terms of distance. It is usually assumed to be Euclidean, but care must be taken because in geospatial analysis we work with projections.\nEven ignoring the caveats regarding distances and projections, the problem lies in the fact that the space being analyzed is not uniform: nature presents geographical features, societies carry out infrastructure projects that modify the distribution of spaces, and cities and living spaces are irregular.\nIn addition, when we carry out reach exercises, time is a constraint. It is not the same to say that there are five health centers within a five-kilometer radius as it is to say that they can be reached in less than T minutes. Thus, we can define the isochrone as follows:\n\nDef. An isochrone \\(I(x,t,Tt,Ht) \\in \\mathbb{R}^2\\) is the area or envelope of the set of routes that can be reached from point \\(x\\) in less than \\(t\\) minutes (or any unit of time measurement) for a type of transport \\(Tt\\) within a defined time frame \\(Ht\\).\n\nAlthough, in general, due to computational cost or lack of information, fixed conditions \\(T_t\\) and \\(H_t\\) are assumed, assumptions must always be specified.\nBelow is an example of a range radius for a 15-minute drive isochrone in Mexico City (average, OSM API, very optimistic arrivals!).\n\n\n\nIsochrones\n\n\nThis irregularity is what makes it necessary to take isochrones into account when studying range from a fixed point.\nThere are many complexities involved in dealing with isochrones, some of which are:\n- Heavy dependence on transportation vehicles.\n- The time of day when the journey is made. \n- Infrastructure and sensitivity to events (accidents).\n- Route adaptability and travel efficiency.\nHowever, their wide range of applications and importance in industry and research make it worthwhile to find algorithms and processes to estimate isochrones more accurately."
  },
  {
    "objectID": "isochrones.html#simulation-assumptions",
    "href": "isochrones.html#simulation-assumptions",
    "title": "Isochrones calculator",
    "section": "Simulation assumptions",
    "text": "Simulation assumptions\nIn addition to assumptions about people’s walking speed, in order to perform a more realistic simulation, the algorithm includes waiting and “traffic” parameters. In other words, let’s look at the following diagram:\n\n\n\nStreet crossing diagram\n\n\nWe assume that if a path is passable on foot, it is also passable by bicycle.\nWe also assume that streets are two-way for pedestrians and bicycles.\nAs we can see, even when walking, especially in an urban area, we are forced to wait for the traffic light to change. Even on pedestrian-only streets, the presence of other people forces us to take these waiting times into account. On the one hand, there is the probability of encountering a red light, and on the other, the waiting time in seconds until it changes. This generates more realistic data. We have included this logic in each of the nodes (corners)."
  },
  {
    "objectID": "isochrones_es.html",
    "href": "isochrones_es.html",
    "title": "Isochrones calculator",
    "section": "",
    "text": "En el análisis geoespacial, una de las cuestiones más importantes es identificar los objetos de interés que se encuentran dentro del alcance de un punto determinado. Piensa en todos los teléfonos móviles a los que llega una antena, en todos los centros médicos que hay alrededor de un punto de la ciudad y en todos los competidores cercanos a una tienda. Para la mayoría de estos problemas, la solución más inmediata consiste en definir el alcance desde un punto en términos de distancia. Normalmente se supone que es euclidiano, pero hay que tener cuidado porque en el análisis geoespacial trabajamos con proyecciones.\nIncluso ignorando las salvedades relativas a las distancias y las proyecciones, el problema radica en que el espacio que se analiza no es uniforme: la naturaleza presenta accidentes geográficos, las sociedades llevan a cabo proyectos de infraestructura que modifican la distribución de los espacios y las ciudades y los espacios habitacionales son irregulares.\nA esto hay que añadir que, cuando realizamos ejercicios de alcance, una restricción es el tiempo. No es lo mismo decir que hay cinco centros de salud en un radio de cinco kilómetros que decir que se pueden alcanzar en menos de T minutos. Así pues, podemos definir la isocrona de la siguiente forma:\n\nDef. Una isocrona \\(I(x,t,Tt,Ht) \\in \\mathbb{R}^2\\), es el área o envolvente del conjunto de rutas que se pueden alcanzar desde el punto \\(x\\) en menos de \\(t\\) minutos (o cualquier unidad de medida del tiempo) para un tipo de transporte \\(Tt\\) en un horario definifo \\(Ht\\)\n\nAunque, por lo general, debido al coste computacional o a la falta de información, se asumen condiciones \\(T_t\\) y \\(H_t\\) fijas, siempre se deben especificar los supuestos.\nA continuación se muestra un ejemplo de radio de alcance para una isocrona de 15 minutos en coche en la Ciudad de México (promedio, API de OSM, ¡llegadas muy optimistas!).\n\n\n\nIsócrona\n\n\nEsta irregularidad es la que hace necesario tener en cuenta las isocronas en el estudio del alcance desde un punto fijo.\nLas complejidades que surgen al lidiar con isocrónas son muchas, algunas de las cuales son:\n- Fuerte dependencia de los vehículos de transporte. \n- El momento del día en que se realiza el trayecto. \n- Infraestructura y sensibilidad a eventos (accidentes). \n- Adaptabilidad de la ruta y eficiencia de los recorridos. \nNo obstante, su gran cantidad de aplicaciones e importancia en la industria y la investigación hacen que valga la pena encontrar algoritmos y procesos para estimar isocronas de forma más precisa."
  },
  {
    "objectID": "isochrones_es.html#supuestos-de-simulación",
    "href": "isochrones_es.html#supuestos-de-simulación",
    "title": "Isochrones calculator",
    "section": "Supuestos de Simulación",
    "text": "Supuestos de Simulación\nAdemás de las suposiciones sobre la velocidad de marcha de las personas, con el fin de realizar una simulación más realista, el algoritmo incluye parámetros de espera y «tráfico». En otras palabras, veamos el siguiente esquema:\n\n\n\nDiagrama de cruce de calles\n\n\nSuponemos que si un camino es transitable a pie, también lo es para bicicletas.\nAsimismo, suponemos que las calles son de doble sentido para peatones y bicicletas.\nComo podemos ver, incluso cuando caminamos, especialmente en una zona urbana, nos vemos obligados a esperar a que cambie el semáforo. Incluso en las calles exclusivas para peatones, la presencia de otras personas nos obliga a tener en cuenta estos tiempos de espera. Por un lado, está la probabilidad de encontrarnos con un semáforo en rojo y, por otro, el tiempo de espera en segundos hasta que cambie. Esto genera datos más realistas. Hemos incluido esta lógica en cada uno de los nodos (esquinas)."
  },
  {
    "objectID": "data_hacks.html",
    "href": "data_hacks.html",
    "title": "Data Hacks",
    "section": "",
    "text": "This page provides a series of APIs, web links and code snippets that I have used for geospatial analysis, enabling the retrieval of data from public sources, government institutions, data science repositories and open-source mapping tools."
  },
  {
    "objectID": "data_hacks.html#mexico-and-latam",
    "href": "data_hacks.html#mexico-and-latam",
    "title": "Data Hacks",
    "section": "Mexico and LatAm",
    "text": "Mexico and LatAm\n\nINEGI\nThe Instituto Nacional de Estadística y Geografía (INEGI) is a Mexican public organisation that provides geographical and population data for research and policy-making. INEGI also provides periodic results from various population and economic censuses and nationwide surveys.\nMarco Geoestadístico\nThe MG (Geostatistical Framework) is a product that combines vector information, attribute tables, and catalogues. It illustrates the division of the national territory into successive levels of geostatistical disaggregation. (INEGI).\nTo get the 2020 MG version , we can run the following command in the root repository:\n# Download zip (3.2 Gb)\nwget \"https://www.inegi.org.mx/contenidos/productos/prod_serv/contenidos/espanol/bvinegi/productos/geografia/marcogeo/889463807469/889463807469_s.zip\" -O ./data/raw/marcogeo_2020.zip\n\n# Unzip files\nunzip -o ./data/raw/marcogeo_2020.zip -d ./data/raw/marco_geo_2020\n\nrm ./data/raw/marcogeo_2020.zip\n\n# Loop for unzip entity level data \nfor z in ./data/raw/marco_geo_2020/*.zip; do\n  [ -e \"$z\" ] || continue   \n  # Create the directory\n  dir=\"${z%.zip}\"           \n  mkdir -p \"$dir\"\n  # Unzip and remove \n  unzip -o \"$z\" -d \"$dir\"\n  rm -f \"$z\"\ndone\nUsing r:\n# Parameters \nURL &lt;- \"https://www.inegi.org.mx/contenidos/productos/prod_serv/contenidos/espanol/bvinegi/productos/geografia/marcogeo/889463807469/889463807469_s.zip\"\nZIP_MAIN &lt;- \"./data/raw/marcogeo_2020.zip\"\nOUT_MAIN &lt;- \"./data/raw/marco_geo_2020\"\n\n# ZIP download  (3.2 GB)\nif (!dir.exists(dirname(ZIP_MAIN))) dir.create(dirname(ZIP_MAIN), recursive = TRUE)\ndownload.file(url, destfile = ZIP_MAIN, mode = \"wb\")\n\n# Unzip file\nunzip(ZIP_MAIN, exdir = OUT_MAIN, overwrite = TRUE)\n\n# Delete ZIP\nfile.remove(ZIP_MAIN)\n\n# Unzip entity level ZIP files \nzip_files &lt;- list.files(OUT_MAIN, pattern = \"\\\\.zip$\", full.names = TRUE)\n\nfor (z in zip_files) {\n  dir_out &lt;- sub(\"\\\\.zip$\", \"\", z)\n  dir.create(dir_out, showWarnings=FALSE, recursive=TRUE)\n  unzip(z, exdir=dir_out, overwrite=TRUE)\n  file.remove(z)\n}\nPython Version:\n\n# Required libraries \nimport os\nimport zipfile\nimport urllib.request\nimport glob\nimport shutil\n\n# Parameters \nURL = \"https://www.inegi.org.mx/contenidos/productos/prod_serv/contenidos/espanol/bvinegi/productos/geografia/marcogeo/889463807469/889463807469_s.zip\"\nZIP_MAIN = \"./data/raw/marcogeo_2020.zip\"\nOUT_MAIN = \"./data/raw/marco_geo_2020\"\n\n# ZIP download  (3.2 GB)\nos.makedirs(os.path.dirname(ZIP_MAIN), exist_ok=True)\nprint(f\"Downloading {URL} → {ZIP_MAIN}\")\nurllib.request.urlretrieve(URL, ZIP_MAIN)\n\n# Unzip file\nprint(f\"Unzipping {ZIP_MAIN} → {OUT_MAIN}\")\nos.makedirs(OUT_MAIN, exist_ok=True)\nwith zipfile.ZipFile(ZIP_MAIN, \"r\") as z:\n    z.extractall(OUT_MAIN)\n\n# Delete main ZIP\nos.remove(ZIP_MAIN)\n\n# Unzip entity level ZIPs \nfor zpath in glob.glob(os.path.join(OUT_MAIN, \"*.zip\")):\n    target_dir = os.path.splitext(zpath)[0]\n    os.makedirs(target_dir, exist_ok=True)\n    try:\n        with zipfile.ZipFile(zpath, \"r\") as z:\n            z.extractall(target_dir)\n    except Exception as e:\n        print(f\"Error extracting {zpath}: {e}\")\n    os.remove(zpath)\nCenso de Población y Vivienda 2020\nThis is one of the most comprehensive data source for finding socio-demographic and economical data from mexican population.\nHere are varios ways to automate results downloading from R, python or command line:\nIn r:\n# Parameters \nOUT_DIR &lt;- './data/raw/mex_censo_2020/'\n\n# Create the out directory \ndir.create(OUT_DIR)\n\n# Create the custom PATHS for entity level census data\npaths &lt;- sprintf(\"https://www.inegi.org.mx/contenidos/programas/ccpv/2020/microdatos/ageb_manzana/RESAGEBURB_%02s_2020_csv.zip\"\n                 , 1:32)\n\n# Download entity zip files\nfor(p in paths){\n  filename &lt;- gsub(\"https://www.inegi.org.mx/contenidos/programas/ccpv/2020/microdatos/ageb_manzana/\",\"\",p)\n  download.file(url = p, \n                destfile = paste0(OUT_DIR,filename),\n                mode = \"wb\",\n                quiet = FALSE)\n}\n\n# Unzip entity level files \nfor(f in list.files(OUT_DIR)){\n  dir_out &lt;- gsub(\".zip\",\"\",f)\n  dir.create(paste0(OUT_DIR, dir_out), showWarnings=FALSE, recursive=TRUE)\n  unzip(paste0(OUT_DIR, f), exdir=paste0(OUT_DIR, dir_out), overwrite=TRUE)\n  file.remove(paste0(OUT_DIR, f))\n}\nCommand Line version:\nset -euo pipefail\n\n# Parameters\nOUT_DIR='./data/raw/mex_censo_2020/'\n\n# Create the out directory\nmkdir -p \"$OUT_DIR\"\n\n# Downloadn entity level ZIPs\nfor i in {1..32}; do\n  printf -v num \"%02d\" \"$i\"\n  url=\"https://www.inegi.org.mx/contenidos/programas/ccpv/2020/microdatos/ageb_manzana/RESAGEBURB_${num}_2020_csv.zip\"\n  filename=\"${url:t}\"                      \n  dest=\"${OUT_DIR}${filename}\"\n\n  echo \"Downloading $url -&gt; $dest\"\n  curl -fL --retry 3 --retry-delay 2 -o \"$dest\" \"$url\"\n\n  dir_out=\"${OUT_DIR}${filename%.zip}\"\n  mkdir -p \"$dir_out\"\n  unzip -o \"$dest\" -d \"$dir_out\"\n  rm -f \"$dest\"\ndone\nPython Version:\n\n# Required Libraries\nimport os\nimport urllib.request\nimport zipfile\n\n# Parameters\nOUT_DIR = \"./data/raw/mex_censo_2020/\"\n\n# Create the out directory\nos.makedirs(OUT_DIR, exist_ok=True)\n\n# Download entity level files \n\n# Base name \nbase = \"https://www.inegi.org.mx/contenidos/programas/ccpv/2020/microdatos/ageb_manzana/RESAGEBURB_{:02d}_2020_csv.zip\"\n\nfor i in range(1, 33):\n    url = base.format(i)\n    filename = url.rsplit(\"/\", 1)[1]\n    dest = os.path.join(OUT_DIR, filename)\n\n    # Download file \n    urllib.request.urlretrieve(url, dest)\n\n    # Extract ZIP files \n    dir_out = os.path.join(OUT_DIR, filename[:-4]) \n    os.makedirs(dir_out, exist_ok=True)\n    with zipfile.ZipFile(dest, \"r\") as z:\n        z.extractall(dir_out)\n\n    # Remove \n    os.remove(dest)"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Geospatial Analytics Lab",
    "section": "",
    "text": "Welcome to my Digital Geospatial Research Lab! The idea behind my personal geospatial and geostatistical analytics lab is to use open-source data and standard mapping tools, as well as applying machine learning algorithms and analytics, to uncover new information about human activity, nature and market dynamics around the globe.\n\n\n\nIsochrone Calculator\nCompute travel-time catchment areas from an origin over a street network.\nPopulation Density Analysis\nAn analysis of how the population is distributed across urban communities in Mexico.\n\n\n\n\nSome background notes that support the projects:\nIn the Data Hacks page, we can review some useful scripts and links into public repositories and open data sources related with geo spatial data.\n\nTo learn more about my broader work visit my main site."
  },
  {
    "objectID": "index.html#projects",
    "href": "index.html#projects",
    "title": "Geospatial Analytics Lab",
    "section": "",
    "text": "Isochrone Calculator\nCompute travel-time catchment areas from an origin over a street network.\nPopulation Density Analysis\nAn analysis of how the population is distributed across urban communities in Mexico."
  },
  {
    "objectID": "index.html#theory-notes",
    "href": "index.html#theory-notes",
    "title": "Geospatial Analytics Lab",
    "section": "",
    "text": "Some background notes that support the projects:\nIn the Data Hacks page, we can review some useful scripts and links into public repositories and open data sources related with geo spatial data.\n\nTo learn more about my broader work visit my main site."
  },
  {
    "objectID": "isochrones_es.html#preparación-de-los-datos",
    "href": "isochrones_es.html#preparación-de-los-datos",
    "title": "Isochrones calculator",
    "section": "Preparación de los datos",
    "text": "Preparación de los datos\nPara preparar los datos se utilizó el siguiente enfoque: utilizando el Marco Geoestadístico 2020 del INEGI, se filtró el archivo de calles de la Ciudad de México por el municipio correspondiente. A partir de este filtro, se aplicó una autointersección para obtener las esquinas correspondientes a las vías del municipio.\n### Data ---------------------------------------------------------------------\n\n# Lines and streets from the point of interest\nshp_streets &lt;- st_read(paste0(RAW_DATA, SHP_DIRECTORY,SHP_FILE_C)) |&gt;\n  filter(CVE_MUN == '014') |&gt; \n  st_transform(crs = CRS_MX)\n\n# We get the corners from LINESTRING \ncorners_sf &lt;- st_intersection(shp_streets) |&gt;\n  filter(st_geometry_type(geometry) == \"POINT\") |&gt;\n  select(origins, geometry)\ncorners_sf &lt;- corners_sf[!duplicated(st_as_binary(corners_sf$geometry)), ] |&gt;\n  mutate(id_node = row_number())\nDefinimos nuestro punto de partida en la CDMX, como en la siguiente  como punto de partida.\nSe fijará un presupuesto de tiempo de 30 minutos y se asume como velocidad de conducción de bicilceta media de 4 metros por segundo.\n### Execution  -----------------------------------------------------------------\n\n# Starting Point \n# https://maps.app.goo.gl/CnuKBE7yScWgANmp8\nlat &lt;- 19.39798481495679\nlon &lt;- -99.1615400498479\n\n# Maximum duration of trajectories in seconds \nT_segs &lt;- 30*60 \n\nVEL_MPS &lt;- 4 # Average velocity in metter per second\n\nTWT_IND &lt;- TRUE # Indicator if there are waiting times \nTRAFFIC_WT &lt;- 120 # Witing time in seconds \nTWT_PROB &lt;- 0.1 # Probability of waiting, wait for green lights\n\nPOINT_TOLERANCE_M &lt;- 150 # tolerance to find corner from point (mts)\nADJ_TOLERANCE_M &lt;- 3 # node-edge adjacency tolerance (mts)\nADJE_TOLERANCE_M &lt;- 3 # tolerance for edge-vertex adjacency (mts) \n\nDISPLAY &lt;- TRUE # Display map\nECHO &lt;- FALSE # Print simulation status"
  },
  {
    "objectID": "isochrones_es.html#ejecución",
    "href": "isochrones_es.html#ejecución",
    "title": "Isochrones calculator",
    "section": "Ejecución",
    "text": "Ejecución\nEjecutamos las simulación con las parámetros definidos, obteniendo los siguientes resultados:\nisoc &lt;- calculate_isochrone(lat,lon,T_segs,shp_streets,corners_sf\n                         , VEL_MPS\n                         , TWT_IND, TRAFFIC_WT,TWT_PROB\n                         , POINT_TOLERANCE_M, ADJ_TOLERANCE_M, ADJE_TOLERANCE_M\n                         , DISPLAY\n                         , ECHO\n                         , CRS_MX)\n\nprint(isoc$mapa)\n\nst_write(isoc$paths_isochrone,paste0(\"./data/sample/\", \"/iso_paths.geojson\")\n         ,layer = \"iso_paths.geojson\" )\n\nst_write(isoc$hull_isochrone,paste0(\"./data/sample/\", \"/iso_hull.geojson\")\n         ,layer = \"iso_hull.geojson\" )\n\n\n\nMapa Resultante\n\n\nEn el mapa anterior podemos ver en color gris claro, las calles de interés (restricción de movimiento) correspondientes a las Alcaldías Miguel Hidalgo, Benito Juárez y Coyoacán. En negro son los caminos alcanzables contenidos en la isócrona, y en color azul la isócrona en sí. El punto de partida esta en color verde y se tienen como objetivo alcanzar el punto azul (oficina).\n\n\n\nPuntos de origen y destino\n\n\nComo observamos en la pasada imagen el punto azul esta dentro de nuestra isócrona, permitiendonos concluir que en efecto, podemos realizar nuestro recorrido en al menos 30 min. bajo los supuestos de movilidad que se tomaron."
  },
  {
    "objectID": "isochrones.html#data-preparation",
    "href": "isochrones.html#data-preparation",
    "title": "Isochrones calculator",
    "section": "Data preparation",
    "text": "Data preparation\nThe following approach was used to prepare the data: using INEGI’s 2020 Geostatistical Framework, the Mexico City street file was filtered by the corresponding municipality. Based on this filter, a self-intersection was applied to obtain the corners corresponding to the municipality’s roads.\n### Data ---------------------------------------------------------------------\n\n# Lines and streets from the point of interest\nshp_streets &lt;- st_read(paste0(RAW_DATA, SHP_DIRECTORY,SHP_FILE_C)) |&gt;\n  filter(CVE_MUN == '014') |&gt; \n  st_transform(crs = CRS_MX)\n\n# We get the corners from LINESTRING \ncorners_sf &lt;- st_intersection(shp_streets) |&gt;\n  filter(st_geometry_type(geometry) == \"POINT\") |&gt;\n  select(origins, geometry)\ncorners_sf &lt;- corners_sf[!duplicated(st_as_binary(corners_sf$geometry)), ] |&gt;\n  mutate(id_node = row_number())\nWe define our starting point in Mexico City as the following address: Dirección.\nA time budget of 30 minutes will be set, and the average cycling speed will be assumed to be 4 meters per second.\n### Execution  -----------------------------------------------------------------\n\n# Starting Point \n# https://maps.app.goo.gl/CnuKBE7yScWgANmp8\nlat &lt;- 19.39798481495679\nlon &lt;- -99.1615400498479\n\n# Maximum duration of trajectories in seconds \nT_segs &lt;- 30*60 \n\nVEL_MPS &lt;- 4 # Average velocity in metter per second\n\nTWT_IND &lt;- TRUE # Indicator if there are waiting times \nTRAFFIC_WT &lt;- 120 # Witing time in seconds \nTWT_PROB &lt;- 0.1 # Probability of waiting, wait for green lights\n\nPOINT_TOLERANCE_M &lt;- 150 # tolerance to find corner from point (mts)\nADJ_TOLERANCE_M &lt;- 3 # node-edge adjacency tolerance (mts)\nADJE_TOLERANCE_M &lt;- 3 # tolerance for edge-vertex adjacency (mts) \n\nDISPLAY &lt;- TRUE # Display map\nECHO &lt;- FALSE # Print simulation status"
  },
  {
    "objectID": "isochrones.html#execution",
    "href": "isochrones.html#execution",
    "title": "Isochrones calculator",
    "section": "Execution",
    "text": "Execution\nGiven the past parameters, we execute the simulation. Getting the following results:\nisoc &lt;- calculate_isochrone(lat,lon,T_segs,shp_streets,corners_sf\n                         , VEL_MPS\n                         , TWT_IND, TRAFFIC_WT,TWT_PROB\n                         , POINT_TOLERANCE_M, ADJ_TOLERANCE_M, ADJE_TOLERANCE_M\n                         , DISPLAY\n                         , ECHO\n                         , CRS_MX)\n\nprint(isoc$mapa)\n\nst_write(isoc$paths_isochrone,paste0(\"./data/sample/\", \"/iso_paths.geojson\")\n         ,layer = \"iso_paths.geojson\" )\n\nst_write(isoc$hull_isochrone,paste0(\"./data/sample/\", \"/iso_hull.geojson\")\n         ,layer = \"iso_hull.geojson\" )\n\n\n\nResulting Map\n\n\nIn the map above, we can see in light gray the streets of interest (movement restriction) corresponding to the Miguel Hidalgo, Benito Juárez, and Coyoacán municipalities. In black are the reachable roads contained in the isochrone, and in blue is the isochrone itself. The starting point is in green, and the goal is to reach the blue point (office).\n\n\n\nPoints of origin and destination\n\n\nAs we can see in the previous image, the blue point is within our isochrone, allowing us to conclude that we can indeed complete our journey in at least 30 minutes under the mobility assumptions that were made."
  }
]